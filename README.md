# Multi voice tasking during wrapup

This plugin allows another call to come in during wrapup.

## Configuration

The plugin consists of two parts: the Flex Plugin and the Serverless Function.  
The Serverless Function is called from within the Flex Plugin.

## Setup Function

```sh
% cd functions
% cp .env.sample .env
```

Update the copied .env file with an editor. The contents to be updated are as follows.

| Params        | Values                                                |
| :------------ | :---------------------------------------------------- |
| WORKSPACE_SID | TaskRouter workspaces sid (String starting with 'WS') |

If you do not find a workspace sid, you can use following url.  
<https://console.twilio.com/us1/develop/taskrouter/workspaces>

```sh
% npm run deploy
> wrapup-multitask@1.0.0 deploy
> twilio serverless:deploy


Deploying functions & assets to the Twilio Runtime

Username        SK***
Password        ***
Service SID     ZS***
Environment     dev
Root Directory  /***/plugin-wrapup-multitask/functions
Dependencies    twilio, @twilio/runtime-handler
Env Variables   API_KEY, API_SECRET
Runtime         node14

âœ” Serverless project successfully deployed

Deployment Details
Domain: wrapup-multitask-XXXX-dev.twil.io
Service:
   wrapup-multitask (ZS***)
Environment:
   dev (ZE***)
Build SID:
   ZB***
Runtime:
   node14
View Live Logs:
   https://www.twilio.com/console/functions/editor/ZS***/environment/ZE***
Functions:
   https://wrapup-multitask-XXXX-dev.twil.io/create-recording
Assets:
```

When the deployment is complete, record the "Domain:" shown in the results.
Such as "wrapup-multitask-XXXX-dev.twil.io".

## Setup Plugin

```sh
% cd ../
% cp .env.sample .env
```

Update the copied .env file with an editor.The contents to be updated are as follows.

| Params                    | Values                                         |
| :------------------------ | :--------------------------------------------- |
| FLEX_APP_FUNCTIONS_DOMAIN | The "Domain" of the Function you just recorded |

Don't forget to prefix each parameter with "FLEX*APP*".

Once the .env file has been updated, build and deploy with the following command.

### Build

```sh
% npm run build
```

### Deploy

```sh
% npm run deploy

...

Next Steps:
Run $ twilio flex:plugins:release --plugin plugin-wrapup-multitask@0.0.X --name "Autogenerated Release 1655765907956" --description "The description of this Flex Plugin Configuration." to enable this plugin on your Flex application
```

Finally, execute the release command as described in "Next Steps:".

```sh
% twilio flex:plugins:release --plugin plugin-wrapup-multitask@0.0.X --name "Autogenerated Release 1655765907956" --description "The description of this Flex Plugin Configuration."
Using profile XXXXXXXXX (AC***)

âœ” Creating configuration
âœ” Enabling configuration FJ***

ðŸš€ Configuration FJ*** was successfully enabled.

Next Steps:
Visit https://flex.twilio.com/admin/plugins to see your plugin(s) live on Flex.
```
